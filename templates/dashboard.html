{% extends "layout.html" %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}
{% block content %}

<h2 class="mb-4"><i class="bi bi-grid-1x2 me-2"></i>Dashboard</h2>

<!-- KPI CARDS -->
<div class="row text-center mb-4">
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h6>Total Media</h6>
                <h3>{{ counts.total }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-2">
        <div class="card shadow-sm">
            <div class="card-body text-success">
                <h6>Present</h6>
                <h3>{{ counts.present }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-2">
        <div class="card shadow-sm">
            <div class="card-body text-warning">
                <h6>Missing</h6>
                <h3>{{ counts.missing }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-2">
        <div class="card shadow-sm">
            <div class="card-body text-primary">
                <h6>Radarr</h6>
                <h3>{{ radarr_info.total }}</h3>
                <div class="small text-muted">Mon: {{ radarr_info.monitored }} · Scar: {{ radarr_info.downloaded }}</div>
            </div>
        </div>
    </div>

    <div class="col-md-2">
        <div class="card shadow-sm">
            <div class="card-body text-info">
                <h6>Sonarr</h6>
                <h3>{{ sonarr_info.total }}</h3>
                <div class="small text-muted">Mon: {{ sonarr_info.monitored }} · Non mon: {{ sonarr_info.unmonitored }}</div>
            </div>
        </div>
    </div>

</div>
<!-- LAST IMPORTS -->
<div class="row mb-4">
    <div class="col-12">
        <h5>Last imports</h5>
        <table class="table table-sm table-striped">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Source</th>
                    <th>Imported</th>
                </tr>
            </thead>
            <tbody>
                {% for i in last_imports %}
                <tr>
                    <td>{{ i.title }}</td>
                    <td>{{ i.source }}</td>
                    <td>{{ i.created_at }}</td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="text-muted">No imports yet</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- WANTED -->
<div class="row">
    <div class="col-md-6">
        <h5>Last Wanted Movies</h5>
        <ul class="list-group">
            {% for m in wanted_movies %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>{{ m.title }} {% if m.year %}({{ m.year }}){% endif %}</span>
                <span class="badge bg-warning text-dark">Missing</span>
            </li>
            {% else %}
            <li class="list-group-item text-muted">No missing movies</li>
            {% endfor %}
        </ul>
    </div>

    <div class="col-md-6">
        <h5>Last Wanted Series</h5>
        <ul class="list-group">
            {% for s in wanted_series %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>{{ s.title }} {% if s.year %}({{ s.year }}){% endif %}</span>
                <span class="badge bg-warning text-dark">Missing</span>
            </li>
            {% else %}
            <li class="list-group-item text-muted">No missing series</li>
            {% endfor %}
        </ul>
    </div>
</div>

{% endblock %}
{% block extra_scripts %}
<script src="{{ url_for('static', filename='scripts/dashboard.js') }}"></script>
{% endblock %}
