{% extends "layout.html" %}
{% block extra_css %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/select/1.7.0/css/select.bootstrap5.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/wanted.css') }}">
{% endblock %}

{% block content %}

<h2><i class="bi bi-star me-2"></i>Wanted Media</h2>

<p>
    Total: <span id="wanted-count-total">...</span> |
    Movie: <span id="wanted-count-movies">...</span> |
    Series: <span id="wanted-count-series">...</span> |
    ID da sistemare: <span id="wanted-count-missing">...</span> |
    In Radarr: <span id="wanted-count-in-radarr">...</span> |
    In Sonarr: <span id="wanted-count-in-sonarr">...</span> |
    Selezionati: <span id="wanted-count-selected">0</span>
</p>

<div class="d-flex flex-wrap align-items-center mb-3 wanted-toolbar">
    <div class="input-group input-group-sm" style="max-width: 320px;">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input id="wanted-title-search" type="text" class="form-control" placeholder="Cerca per titolo..." disabled>
    </div>
    <div class="input-group input-group-sm" style="max-width: 170px;">
        <span class="input-group-text">Tipo</span>
        <select id="wanted-type-filter" class="form-select" disabled>
            <option value="all">Tutti</option>
            <option value="movie">Movie</option>
            <option value="series">Series</option>
        </select>
    </div>
    <div class="input-group input-group-sm" style="max-width: 220px;">
        <span class="input-group-text">Import</span>
        <select id="wanted-import-filter" class="form-select" disabled>
            <option value="all">Tutti</option>
        </select>
    </div>
    <div class="btn-group btn-group-sm" role="group" aria-label="Selezione">
        <button type="button" class="btn btn-outline-secondary" id="select-visible-btn" disabled>
            <i class="bi bi-check2-square"></i>
            Tutti
        </button>
        <button type="button" class="btn btn-outline-secondary" id="select-downloaded-btn" disabled>
            Completi
        </button>
        <button type="button" class="btn btn-outline-secondary" id="select-tmdb-btn" disabled>
            TMDB
        </button>
        <button type="button" class="btn btn-outline-secondary" id="select-tvdb-btn" disabled>
            TVDB
        </button>
        <button type="button" class="btn btn-outline-secondary" id="select-radarr-btn" disabled>
            Radarr
        </button>
        <button type="button" class="btn btn-outline-secondary" id="select-sonarr-btn" disabled>
            Sonarr
        </button>
        <button type="button" class="btn btn-outline-secondary" id="clear-selection-btn" disabled>
            <i class="bi bi-x-square"></i>
            Niente
        </button>
    </div>
    <div class="btn-group btn-group-sm" role="group" aria-label="Azioni bulk">
        <button type="button" class="btn btn-danger" id="bulk-delete-btn" data-bs-toggle="modal" data-bs-target="#bulkDeleteModal" disabled>
            <i class="bi bi-trash"></i>
            Elimina
        </button>
        <button type="button" class="btn btn-radarr" id="bulk-radarr-btn" data-bs-toggle="modal" data-bs-target="#bulkRadarrModal" disabled>
            <i class="bi bi-cloud-upload"></i>
            Radarr
        </button>
        <button type="button" class="btn btn-sonarr" id="bulk-sonarr-btn" data-bs-toggle="modal" data-bs-target="#bulkSonarrModal" disabled>
            <i class="bi bi-cloud-upload"></i>
            Sonarr
        </button>
        <button type="button" class="btn btn-outline-secondary" id="bulk-merge-btn" data-bs-toggle="modal" data-bs-target="#mergeWantedModal" disabled>
            <i class="bi bi-diagram-3"></i>
            Merge
        </button>
    </div>
    <div class="btn-group btn-group-sm" role="group" aria-label="Auto match">
        <button type="button" class="btn btn-outline-secondary" id="bulk-match-tvdb-btn" data-bs-toggle="modal" data-bs-target="#bulkMatchModal" disabled>
            <i class="bi bi-search"></i>
            Auto TVDB
        </button>
        <button type="button" class="btn btn-outline-secondary" id="bulk-match-tmdb-btn" data-bs-toggle="modal" data-bs-target="#bulkMatchModal" disabled>
            <i class="bi bi-film"></i>
            Auto TMDB
        </button>
    </div>
</div>
</div>

<div id="wanted-skeleton" class="wanted-skeleton">
    <div class="wanted-skeleton__row"></div>
    <div class="wanted-skeleton__row"></div>
    <div class="wanted-skeleton__row"></div>
    <div class="wanted-skeleton__row"></div>
    <div class="wanted-skeleton__row"></div>
</div>
<div id="wanted-config" data-radarr-url="{{ radarr_url }}" class="d-none"></div>
<div id="wanted-content" class="d-none"></div>

<div class="modal fade" id="bulkMatchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">

            <div class="modal-header border-0">
                <h5 class="modal-title" id="bulk-match-title">Auto-match</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <div class="alert alert-info d-none" id="bulk-match-status">Ricerca in corso...</div>
                <div class="alert alert-danger d-none" id="bulk-match-error">Errore durante la ricerca.</div>
                <div class="d-flex flex-wrap gap-3 small text-muted mb-2">
                    <div>Selezionati: <strong id="bulk-match-selected">0</strong></div>
                    <div>Con match: <strong id="bulk-match-found">0</strong></div>
                    <div>Senza match: <strong id="bulk-match-missing">0</strong></div>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm table-striped align-middle" id="bulk-match-table">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 40px;"></th>
                                <th>Titolo</th>
                                <th style="width: 90px;">Anno</th>
                                <th style="width: 90px;">Tipo</th>
                                <th>Query</th>
                                <th>Match</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer border-0">
                <div class="me-auto small text-muted" id="bulk-match-summary"></div>
                <button class="btn btn-light" data-bs-dismiss="modal">Annulla</button>
                <button type="button" class="btn btn-primary" id="bulk-match-confirm">Applica</button>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/select/1.7.0/js/dataTables.select.min.js"></script>
<script src="{{ url_for('static', filename='scripts/wanted.js') }}"></script>
{% endblock %}
