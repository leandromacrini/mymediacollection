{% extends "layout.html" %}

{% block content %}
<style>
    #radarr_table {
        table-layout: fixed;
        width: 100%;
    }
    #radarr_table th,
    #radarr_table td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    #radarr_table th:nth-child(1),
    #radarr_table td:nth-child(1) { width: 36%; }
    #radarr_table th:nth-child(2),
    #radarr_table td:nth-child(2) { width: 8%; }
    #radarr_table th:nth-child(3),
    #radarr_table td:nth-child(3) { width: 12%; }
    #radarr_table th:nth-child(4),
    #radarr_table td:nth-child(4) { width: 12%; }
    #radarr_table th:nth-child(5),
    #radarr_table td:nth-child(5) { width: 10%; }
    #radarr_table th:nth-child(6),
    #radarr_table td:nth-child(6) { width: 10%; }
</style>
<h2>Radarr Movies</h2>
{% set stats = namespace(total=0, monitored=0, downloaded=0) %}
{% for m in movies %}
    {% set stats.total = stats.total + 1 %}
    {% if m.monitored %}{% set stats.monitored = stats.monitored + 1 %}{% endif %}
    {% if m.has_file %}{% set stats.downloaded = stats.downloaded + 1 %}{% endif %}
{% endfor %}
<p>
    Total Movies: {{ stats.total }} |
    Monitorati: {{ stats.monitored }} |
    Scaricati: {{ stats.downloaded }}
</p>

<table id="radarr_table" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Title</th>
            <th>Year</th>
            <th>TMDb ID</th>
            <th>IMDb ID</th>
            <th>Monitored</th>
            <th>Downloaded</th>
        </tr>
    </thead>
    <tbody>
        {% for m in movies %}
        <tr>
            <td>
                <a href="{{ radarr_url }}/movie/{{ m.tmdb_id }}" target="_blank">
                    {{ m.title }}
                </a>
            </td>
            <td>{{ m.year }}</td>
            <td>{{ m.tmdb_id }}</td>
            <td>{{ m.imdb_id }}</td>
            <td>{{ "Yes" if m.monitored else "No" }}</td>
            <td>{{ "Yes" if m.has_file else "No" }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- DataTables JS/CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
$(document).ready(function() {
    $('#radarr_table').DataTable({
        "paging": true,
        "ordering": true,
        "order": [[1, "desc"]],  // default: order by Title descending
        "pageLength": 25
    });
});
</script>

{% endblock %}
